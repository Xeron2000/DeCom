import{A as W,k as P,m as v,I,p as N,n as Y,o as J,q as Q,r as d,t as X,u as Z,v as ee,x as te,y as S,z as H,F as R,C as se,B as z,D as ne,G as re,J as G,K as ae,L as oe,M as ie,N as ce,O as ue,P as de,Q as T,R as le,S as fe,V as he,W as pe,X as xe,Y as me,Z as F,_ as O,$ as ge,a0 as $,h as we,a1 as ye,a2 as be,f as j,a3 as M,a4 as Pe,a5 as ze,a6 as Te,a7 as _,a8 as ve,a9 as Ie,aa as q,ab as Ce,ac as B,ad as Ee,i as Fe,s as Ae,ae as Le,af as Se,ag as ke,ah as Ne,ai as Ge,aj as Me,ak as _e}from"./index-fpAAkCtu.js";function et(e,t){if(e.length!==t.length)throw new W({expectedLength:e.length,givenLength:t.length});const s=[];for(let n=0;n<e.length;n++){const r=e[n],a=t[n];s.push(D(r,a))}return P(s)}function D(e,t,s=!1){if(e==="address"){const i=t;if(!v(i))throw new I({address:i});return N(i.toLowerCase(),{size:s?32:null})}if(e==="string")return Y(t);if(e==="bytes")return t;if(e==="bool")return N(J(t),{size:s?32:1});const n=e.match(Q);if(n){const[i,o,l="256"]=n,f=Number.parseInt(l,10)/8;return d(t,{size:s?32:f,signed:o==="int"})}const r=e.match(X);if(r){const[i,o]=r;if(Number.parseInt(o,10)!==(t.length-2)/2)throw new Z({expectedSize:Number.parseInt(o,10),givenSize:(t.length-2)/2});return N(t,{dir:"right",size:s?32:null})}const a=e.match(ee);if(a&&Array.isArray(t)){const[i,o]=a,l=[];for(let f=0;f<t.length;f++)l.push(D(o,t[f],!0));return l.length===0?"0x":P(l)}throw new te(e)}function Be(e){const{authorizationList:t}=e;if(t)for(const s of t){const{chainId:n}=s,r=s.address;if(!v(r))throw new I({address:r});if(n<0)throw new S({chainId:n})}V(e)}function He(e){const{blobVersionedHashes:t}=e;if(t){if(t.length===0)throw new ne;for(const s of t){const n=re(s),r=G(ae(s,0,1));if(n!==32)throw new oe({hash:s,size:n});if(r!==ie)throw new ce({hash:s,version:r})}}V(e)}function V(e){const{chainId:t,maxPriorityFeePerGas:s,maxFeePerGas:n,to:r}=e;if(t<=0)throw new S({chainId:t});if(r&&!v(r))throw new I({address:r});if(n&&n>H)throw new R({maxFeePerGas:n});if(s&&n&&s>n)throw new se({maxFeePerGas:n,maxPriorityFeePerGas:s})}function Re(e){const{chainId:t,maxPriorityFeePerGas:s,gasPrice:n,maxFeePerGas:r,to:a}=e;if(t<=0)throw new S({chainId:t});if(a&&!v(a))throw new I({address:a});if(s||r)throw new z("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid EIP-2930 Transaction attribute.");if(n&&n>H)throw new R({maxFeePerGas:n})}function Ve(e){const{chainId:t,maxPriorityFeePerGas:s,gasPrice:n,maxFeePerGas:r,to:a}=e;if(a&&!v(a))throw new I({address:a});if(typeof t<"u"&&t<=0)throw new S({chainId:t});if(s||r)throw new z("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid Legacy Transaction attribute.");if(n&&n>H)throw new R({maxFeePerGas:n})}function k(e){if(!e||e.length===0)return[];const t=[];for(let s=0;s<e.length;s++){const{address:n,storageKeys:r}=e[s];for(let a=0;a<r.length;a++)if(r[a].length-2!==64)throw new ue({storageKey:r[a]});if(!v(n,{strict:!1}))throw new I({address:n});t.push([n,r])}return t}function tt(e,t){const s=de(e);return s==="eip1559"?qe(e,t):s==="eip2930"?$e(e,t):s==="eip4844"?je(e,t):s==="eip7702"?Oe(e,t):De(e,t)}function Oe(e,t){const{authorizationList:s,chainId:n,gas:r,nonce:a,to:i,value:o,maxFeePerGas:l,maxPriorityFeePerGas:f,accessList:c,data:p}=e;Be(e);const h=k(c),u=Ke(s);return P(["0x04",T([d(n),a?d(a):"0x",f?d(f):"0x",l?d(l):"0x",r?d(r):"0x",i??"0x",o?d(o):"0x",p??"0x",h,u,...A(e,t)])])}function je(e,t){const{chainId:s,gas:n,nonce:r,to:a,value:i,maxFeePerBlobGas:o,maxFeePerGas:l,maxPriorityFeePerGas:f,accessList:c,data:p}=e;He(e);let h=e.blobVersionedHashes,u=e.sidecars;if(e.blobs&&(typeof h>"u"||typeof u>"u")){const b=typeof e.blobs[0]=="string"?e.blobs:e.blobs.map(E=>le(E)),L=e.kzg,C=fe({blobs:b,kzg:L});if(typeof h>"u"&&(h=he({commitments:C})),typeof u>"u"){const E=pe({blobs:b,commitments:C,kzg:L});u=xe({blobs:b,commitments:C,proofs:E})}}const g=k(c),w=[d(s),r?d(r):"0x",f?d(f):"0x",l?d(l):"0x",n?d(n):"0x",a??"0x",i?d(i):"0x",p??"0x",g,o?d(o):"0x",h??[],...A(e,t)],x=[],m=[],y=[];if(u)for(let b=0;b<u.length;b++){const{blob:L,commitment:C,proof:E}=u[b];x.push(L),m.push(C),y.push(E)}return P(["0x03",u?T([w,x,m,y]):T(w)])}function qe(e,t){const{chainId:s,gas:n,nonce:r,to:a,value:i,maxFeePerGas:o,maxPriorityFeePerGas:l,accessList:f,data:c}=e;V(e);const p=k(f),h=[d(s),r?d(r):"0x",l?d(l):"0x",o?d(o):"0x",n?d(n):"0x",a??"0x",i?d(i):"0x",c??"0x",p,...A(e,t)];return P(["0x02",T(h)])}function $e(e,t){const{chainId:s,gas:n,data:r,nonce:a,to:i,value:o,accessList:l,gasPrice:f}=e;Re(e);const c=k(l),p=[d(s),a?d(a):"0x",f?d(f):"0x",n?d(n):"0x",i??"0x",o?d(o):"0x",r??"0x",c,...A(e,t)];return P(["0x01",T(p)])}function De(e,t){const{chainId:s=0,gas:n,data:r,nonce:a,to:i,value:o,gasPrice:l}=e;Ve(e);let f=[a?d(a):"0x",l?d(l):"0x",n?d(n):"0x",i??"0x",o?d(o):"0x",r??"0x"];if(t){const c=(()=>{if(t.v>=35n)return(t.v-35n)/2n>0?t.v:27n+(t.v===35n?0n:1n);if(s>0)return BigInt(s*2)+BigInt(35n+t.v-27n);const u=27n+(t.v===27n?0n:1n);if(t.v!==u)throw new me({v:t.v});return u})(),p=F(t.r),h=F(t.s);f=[...f,d(c),p==="0x00"?"0x":p,h==="0x00"?"0x":h]}else s>0&&(f=[...f,d(s),"0x","0x"]);return T(f)}function A(e,t){const s=t??e,{v:n,yParity:r}=s;if(typeof s.r>"u")return[];if(typeof s.s>"u")return[];if(typeof n>"u"&&typeof r>"u")return[];const a=F(s.r),i=F(s.s);return[typeof r=="number"?r?d(1):"0x":n===0n?"0x":n===1n?d(1):n===27n?"0x":d(1),a==="0x00"?"0x":a,i==="0x00"?"0x":i]}function Ke(e){if(!e||e.length===0)return[];const t=[];for(const s of e){const{chainId:n,nonce:r,...a}=s,i=s.address;t.push([n?O(n):"0x",i,r?O(r):"0x",...A({},a)])}return t}function Ue(e){const{source:t}=e,s=new Map,n=new ge(8192),r=new Map,a=({address:i,chainId:o})=>`${i}.${o}`;return{async consume({address:i,chainId:o,client:l}){const f=a({address:i,chainId:o}),c=this.get({address:i,chainId:o,client:l});this.increment({address:i,chainId:o});const p=await c;return await t.set({address:i,chainId:o},p),n.set(f,p),p},async increment({address:i,chainId:o}){const l=a({address:i,chainId:o}),f=s.get(l)??0;s.set(l,f+1)},async get({address:i,chainId:o,client:l}){const f=a({address:i,chainId:o});let c=r.get(f);return c||(c=(async()=>{try{const h=await t.get({address:i,chainId:o,client:l}),u=n.get(f)??0;return u>0&&h<=u?u+1:(n.delete(f),h)}finally{this.reset({address:i,chainId:o})}})(),r.set(f,c)),(s.get(f)??0)+await c},reset({address:i,chainId:o}){const l=a({address:i,chainId:o});s.delete(l),r.delete(l)}}}function We(){return{async get(e){const{address:t,client:s}=e;return $(s,{address:t,blockTag:"pending"})},set(){}}}const st=Ue({source:We()}),Ye="0x6492649264926492649264926492649264926492649264926492649264926492",nt="0x0000000000000000000000000000000000000000000000000000000000000000";function rt(e){const{address:t,data:s,signature:n,to:r="hex"}=e,a=P([we([{type:"address"},{type:"bytes"},{type:"bytes"}],[t,s,n]),Ye]);return r==="hex"?a:ye(a)}const K="0x5792579257925792579257925792579257925792579257925792579257925792",U=d(0,{size:32});async function at(e,t){const{account:s=e.account,capabilities:n,chain:r=e.chain,experimental_fallback:a,experimental_fallbackDelay:i=32,forceAtomic:o=!1,id:l,version:f="2.0.0"}=t,c=s?M(s):null,p=t.calls.map(h=>{const u=h,g=u.abi?be({abi:u.abi,functionName:u.functionName,args:u.args}):u.data;return{data:u.dataSuffix&&g?j([g,u.dataSuffix]):g,to:u.to,value:u.value?d(u.value):void 0}});try{const h=await e.request({method:"wallet_sendCalls",params:[{atomicRequired:o,calls:p,capabilities:n,chainId:d(r.id),from:c==null?void 0:c.address,id:l,version:f}]},{retryCount:0});return typeof h=="string"?{id:h}:h}catch(h){const u=h;if(a&&(u.name==="MethodNotFoundRpcError"||u.name==="MethodNotSupportedRpcError"||u.name==="UnknownRpcError"||u.details.toLowerCase().includes("does not exist / is not available")||u.details.toLowerCase().includes("missing or invalid. request()")||u.details.toLowerCase().includes("did not match any variant of untagged enum")||u.details.toLowerCase().includes("account upgraded to unsupported contract")||u.details.toLowerCase().includes("eip-7702 not supported")||u.details.toLowerCase().includes("unsupported wc_ method")||u.details.toLowerCase().includes("feature toggled misconfigured")||u.details.toLowerCase().includes("jsonrpcengine: response has no error or result for request"))){if(n&&Object.values(n).some(y=>!y.optional)){const y="non-optional `capabilities` are not supported on fallback to `eth_sendTransaction`.";throw new Pe(new z(y,{details:y}))}if(o&&p.length>1){const m="`forceAtomic` is not supported on fallback to `eth_sendTransaction`.";throw new ze(new z(m,{details:m}))}const g=[];for(const m of p){const y=Te(e,{account:c,chain:r,data:m.data,to:m.to,value:m.value?_(m.value):void 0});g.push(y),i>0&&await new Promise(b=>setTimeout(b,i))}const w=await Promise.allSettled(g);if(w.every(m=>m.status==="rejected"))throw w[0].reason;const x=w.map(m=>m.status==="fulfilled"?m.value:U);return{id:j([...x,d(r.id,{size:32}),K])}}throw ve(h,{...t,account:c,chain:t.chain})}}async function Je(e,t){async function s(c){if(c.endsWith(K.slice(2))){const h=F(q(c,-64,-32)),u=q(c,0,-64).slice(2).match(/.{1,64}/g),g=await Promise.all(u.map(x=>U.slice(2)!==x?e.request({method:"eth_getTransactionReceipt",params:[`0x${x}`]},{dedupe:!0}):void 0)),w=g.some(x=>x===null)?100:g.every(x=>(x==null?void 0:x.status)==="0x1")?200:g.every(x=>(x==null?void 0:x.status)==="0x0")?500:600;return{atomic:!1,chainId:G(h),receipts:g.filter(Boolean),status:w,version:"2.0.0"}}return e.request({method:"wallet_getCallsStatus",params:[c]})}const{atomic:n=!1,chainId:r,receipts:a,version:i="2.0.0",...o}=await s(t.id),[l,f]=(()=>{const c=o.status;return c>=100&&c<200?["pending",c]:c>=200&&c<300?["success",c]:c>=300&&c<700?["failure",c]:c==="CONFIRMED"?["success",200]:c==="PENDING"?["pending",100]:[void 0,c]})();return{...o,atomic:n,chainId:r?G(r):void 0,receipts:(a==null?void 0:a.map(c=>({...c,blockNumber:_(c.blockNumber),gasUsed:_(c.gasUsed),status:Ie[c.status]})))??[],statusCode:f,status:l,version:i}}async function ot(e,t){var l;const{account:s=e.account,chainId:n,nonce:r}=t;if(!s)throw new Ce({docsPath:"/docs/eip7702/prepareAuthorization"});const a=M(s),i=(()=>{if(t.executor)return t.executor==="self"?t.executor:M(t.executor)})(),o={address:t.contractAddress??t.address,chainId:n,nonce:r};return typeof o.chainId>"u"&&(o.chainId=((l=e.chain)==null?void 0:l.id)??await B(e,Ee,"getChainId")({})),typeof o.nonce>"u"&&(o.nonce=await B(e,$,"getTransactionCount")({address:a.address,blockTag:"pending"}),(i==="self"||i!=null&&i.address&&Fe(i.address,a.address))&&(o.nonce+=1)),o}class Qe extends z{constructor(t){super(`Call bundle failed with status: ${t.statusCode}`,{name:"BundleFailedError"}),Object.defineProperty(this,"result",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.result=t}}async function it(e,t){const{id:s,pollingInterval:n=e.pollingInterval,status:r=({statusCode:w})=>w===200||w>=300,retryCount:a=4,retryDelay:i=({count:w})=>~~(1<<w)*200,timeout:o=6e4,throwOnFailure:l=!1}=t,f=Ae(["waitForCallsStatus",e.uid,s]),{promise:c,resolve:p,reject:h}=Le();let u;const g=Se(f,{resolve:p,reject:h},w=>{const x=ke(async()=>{const m=y=>{clearTimeout(u),x(),y(),g()};try{const y=await Ne(async()=>{const b=await B(e,Je,"getCallsStatus")({id:s});if(l&&b.status==="failure")throw new Qe(b);return b},{retryCount:a,delay:i});if(!r(y))return;m(()=>w.resolve(y))}catch(y){m(()=>w.reject(y))}},{interval:n,emitOnBegin:!0});return x});return u=o?setTimeout(()=>{g(),clearTimeout(u),h(new Xe({id:s}))},o):void 0,await c}class Xe extends z{constructor({id:t}){super(`Timed out while waiting for call bundle with id "${t}" to be confirmed.`,{name:"WaitForCallsStatusTimeoutError"})}}function ct(e){const{key:t="public",name:s="Public Client"}=e;return Ge({...e,key:t,name:s,type:"publicClient"}).extend(Me)}function ut(e){const{r:t,s}=_e.Signature.fromCompact(e.slice(2,130)),n=+`0x${e.slice(130)}`,[r,a]=(()=>{if(n===0||n===1)return[void 0,n];if(n===27)return[BigInt(n),0];if(n===28)return[BigInt(n),1];throw new Error("Invalid yParityOrV value")})();return typeof r<"u"?{r:d(t,{size:32}),s:d(s,{size:32}),v:r,yParity:a}:{r:d(t,{size:32}),s:d(s,{size:32}),yParity:a}}export{Qe as B,Xe as W,rt as a,ct as b,Ue as c,ut as d,et as e,Ye as f,V as g,Re as h,He as i,Be as j,Ve as k,at as l,Je as m,st as n,k as o,ot as p,tt as s,it as w,nt as z};
